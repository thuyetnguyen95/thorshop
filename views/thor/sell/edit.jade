extends ../layout/master

block content

  nav(aria-label='breadcrumb' class="mb-4 mt-4")
    ol.breadcrumb
      li.breadcrumb-item
        a(href='/thor/sold') ƒê√£ b√°n
      li.breadcrumb-item Ch·ªânh s·ª≠a
  hr
  
  .row
    .col-md-8.col-sm-12
      form(action="/thor/sold/edit/#{order.id}" method="post")
        h6 Th√¥ng tin ng∆∞·ªùi mua
        .row
          .form-group.col-md-3
            label(for='f_filter_name') L·ªçc theo t√™n
            input#f_filter_user.form-control(type='text' oninput="onFilterUser()")
          .form-group.col-md-4
            label(for='f_user') T√™n ng∆∞·ªùi mua
            .d-flex
              select#f_user.form-control(name="userId" required)
                option(value='') -- Ch·ªçn t√™n kh√°ch h√†ng --
                each user in users
                  option(value=user.id selected=order.userId === user.id)= user.name
              button.btn.btn-secondary.ml-2(type="button" onclick="resetCustomer('#{order.userId}')") Reset

        h6.mt-4 Th√¥ng tin s·∫£n ph·∫©m
        .row
          .col-md-8.col-sm-12
            table.table.table-product
              thead
                tr
                  th(scope='col') #
                  th(scope='col') T√™n s·∫£n ph·∫©m
                  th(scope='col') S·ªë l∆∞·ª£ng
                  th(scope='col') Gi√°
                  th(scope='col') T√°c v·ª•
              tbody#orderProduct
                each product, index in order.productInfo
                  - var productAv = products.filter(item => item.id === product.id)
                  if productAv.length
                    - var productYasuo = productAv[0]
                    tr(id=`product_${productYasuo.id}`)
                      td.productId(style="display:none;")= productYasuo.id
                      th(scope='row')= index + 1
                      td
                        a.text-capitalize(href="#")=  productYasuo.name
                      td.productQty(style="width: 150px;" id="f_product_qty_#{productYasuo.id}")= product.qty
                      td(style="width: 150px;" id="f_product_price_#{productYasuo.id}")
                        span= product.price.toLocaleString('it-IT', {style : 'currency', currency : 'VND'})
                        span.productPrice(style="display:none")= product.price
                      td(style="width: 150px;")
                        button(title="Th√™m" type="button" class="btn btn-sm btn-info" onclick="increment('#{productYasuo.id}', #{productYasuo.price})")
                          i.fa.fa-plus
                        button(title="Gi·∫£m" type="button" class="btn btn-sm btn-warning" onclick="decrement('#{productYasuo.id}', #{productYasuo.price})")
                          i.fa.fa-minus
                        button(
                          title="Lo·∫°i b·ªè"
                          type="button"
                          class="btn btn-sm btn-danger"
                          data-toggle='modal'
                          data-target='#modalConfirmDelete'
                          onclick="remove('#{productYasuo.id}', #{productYasuo.price}, #{product.qty})"
                        )
                          i.fa.fa-trash
        h6.mt-4 Th√¥ng tin thanh to√°n
        .row
          .form-group.col-md-4
            label(for='f_total_price') T·ªïng ti·ªÅn
            .input-group.mb-3
              .input-group-prepend
                span.input-group-text $
              input#f_total_price.form-control(type='number' value=order.totalPrice name="total_price" readonly)
              .input-group-append
                span.input-group-text ƒë
        .row
          .form-group.col-md-4
            label(for='f_pay') Thanh to√°n
            input#f_pay.form-control(type='number' name="pay" value=order.pay required oninput="onChangePay()")
        .row
          .form-group.col-md-4
            label(for='f_in_debt') N·ª£
            .input-group.mb-3
              .input-group-prepend
                span.input-group-text $
              input#f_in_debt.form-control(type='number' value=order.inDebt name="in_debt" readonly)
              .input-group-append
                span.input-group-text ƒë
        .row
          .form-group.col-md-4
            label(for='f_refund') Tr·∫£ l·∫°i
            .input-group.mb-3
              .input-group-prepend
                span.input-group-text $
              - var refund = order.totalPrice - order.pay < 0 ? Math.abs(order.totalPrice - order.pay) : ''
              input#f_refund.form-control(type='number' value=refund readonly)
              .input-group-append
                span.input-group-text ƒë
        .row
          .form-group.col-md-6
            label(for='f_note') Ghi ch√∫
            textarea#f_note.form-control(autocomplete="off" name="note" value=order.note)= order.note
        
        input#productInfo(type="hidden" name="productInfo")

        a.btn.btn-secondary(href="/thor/sold") Tr·ªü l·∫°i 
        button.btn.btn-success.ml-2(type='submit') Thanh to√°n

  #modalConfirmDelete.modal.fade(tabindex='-1' role='dialog' aria-hidden='true')
    .modal-dialog.modal-dialog-centered(role='document')
      .modal-content
        .modal-header
          h5#exampleModalLongTitle.modal-title üò≠üò≠ Oh no!
          button.close(type='button' data-dismiss='modal' aria-label='Close')
            span(aria-hidden='true') &times;
        .modal-body
          p.text-danger Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c.
          p.text-danger B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën xo√°?
        .modal-footer
          button.btn.btn-secondary.btn-sm(type='button' data-dismiss='modal') ƒê√≥ng
          button.btn.btn-danger.btn-sm(type='button' onclick="deleteProduct()") Xo√°

block script
  script(src="/js/edit-order.js")

block style
  style.
    .table-product button {
      margin-right: 6px;
      color: #fff;
    }

    .table-product button:hover {
      color: #fff;
    }